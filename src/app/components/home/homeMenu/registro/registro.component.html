<!--
  CONSIDERACIONES:
  - Los MatStepperNext y MatStepperPrevious deben ser type="button" para que no haga el submit cada vez que se aprieta,
  sino que se haga unicamente con el boton de registro final del formulario.
-->

<form [formGroup]="frmStepper" (ngSubmit)="submit()">

<mat-horizontal-stepper [linear]="isLinear" formArrayName="steps" #stepper>
  <mat-step formGroupName="0" [stepControl]="formArray.get([0])">
      <ng-template matStepLabel>Generalidades</ng-template>
      <mat-form-field class="mr-5">
        <mat-label>Fecha</mat-label>
        <input matInput [matDatepicker]="picker">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Sistema</mat-label>
        <mat-select formControlName="Sistema">
          <mat-option *ngFor="let sistema of sistemas" [value]="sistema" >
            {{sistema}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Ubicación</mat-label>
        <mat-select formControlName="Ubicacion">
          <mat-option *ngFor="let ubicacion of ubicaciones" [value]="ubicacion">
            {{ubicacion}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Componente</mat-label>
        <mat-select formControlName="Componente">
          <mat-option *ngFor="let componente of componentes" [value]="componente">
            {{componente}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Marca del componente</mat-label>
        <mat-select formControlName="MarcaDelComponente">
          <mat-option *ngFor="let marcaComponente of marcaComponentes" [value]="marcaComponente">
            {{marcaComponente}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Proveedor</mat-label>
        <mat-select formControlName="Proveedor">
          <mat-option *ngFor="let proveedor of proveedores" [value]="proveedor">
            {{proveedor}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div>
        <button mat-button type="button" matStepperNext>Next</button>
      </div>
  </mat-step>
  <!--Step 2-->
  <mat-step formGroupName="1" [stepControl]="formArray.get([1])" label="Detalle">
    
      <mat-form-field class="mr-5">
        <mat-label>Origen del problema</mat-label>
        <mat-select formControlName="OrigenDelProblema">
          <mat-option *ngFor="let origenDeProblema of origenesDeProblema" [value]="origenDeProblema">
            {{origenDeProblema}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Efecto</mat-label>
        <mat-select formControlName="Efecto">
          <mat-option *ngFor="let efecto of efectos" [value]="efecto">
            {{efecto}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Severidad</mat-label>
        <mat-select formControlName="Severidad">
          <mat-option *ngFor="let nivel of niveles" [value]="nivel">
            {{nivel}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Impacto en usuarios</mat-label>
        <mat-select formControlName="ImpactoEnUsuarios">
          <mat-option *ngFor="let nivel of niveles" [value]="nivel">
            {{nivel}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Personal encargado</mat-label>
        <mat-select formControlName="PersonalEncargado">
          <mat-option *ngFor="let encargado of encargados" [value]="encargado">
            {{encargado}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Costo</mat-label>
        <input matInput type="number" formControlName="Costo">
        <span matPrefix>S/.&nbsp;</span>
      </mat-form-field>
      <mat-form-field class="mr-5">
        <mat-label>Tiempo</mat-label>
        <input matInput type="number" formControlName="Tiempo">
      </mat-form-field>
      <br>
      <div class="container-fluid p-0">
        <div class="row">
          <div class="col">
            <mat-form-field class="mr-5 big-text">
              <mat-label>Descripción del problema</mat-label>
              <textarea matInput class="big-text" formControlName="DescripcionDelProblema"></textarea>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field class="mr-5 big-text">
              <mat-label>Causa</mat-label>
              <textarea matInput class="big-text" formControlName="Causa"></textarea>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="container-fluid p-0">
        <div class="row">
          <div class="col">
            <mat-form-field class="mr-5 big-text">
              <mat-label>Consecuencia</mat-label>
              <textarea matInput class="big-text" formControlName="Consecuencia"></textarea>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field class="mr-5 big-text">
              <mat-label>Acción emprendida</mat-label>
              <textarea matInput class="big-text" formControlName="AccionEmprendida"></textarea>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="mt-3">
        <button mat-button type="button" matStepperPrevious>Back</button>
        <button mat-button type="button" matStepperNext>Next</button>
      </div>
  </mat-step>
  <!--Step 3-->
  <mat-step formGroupName="2" [stepControl]="formArray.get([2])" label="Lección aprendida">
      <mat-form-field class="mr-5">
        <mat-label>Tipo de lección aprendida</mat-label>
        <mat-select formControlName="TipoDeLeccionAprendida">
          <mat-option *ngFor="let tipoDeLeccionAprendida of tiposDeLeccionAprendida" [value]="tipoDeLeccionAprendida">
            {{tipoDeLeccionAprendida}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="mr-5 text-fit">
        <mat-label class="text-fit">(REVISAR)¿A quien debe ser reportada esta lección aprendida?</mat-label>
        <mat-select formControlName="Reportado">
          <mat-option *ngFor="let encargado of encargados" [value]="encargado">
            {{encargado}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div class="container-fluid p-0">
        <div class="row">
          <div class="col">
            <mat-form-field class="mr-5 big-text">
              <mat-label>¿Qué se puede rescatar de la acción emprendida?</mat-label>
              <textarea matInput class="big-text" formControlName="Rescatar"></textarea>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field class="mr-5 big-text">
              <mat-label>Mejora propuesta por el especialista</mat-label>
              <textarea matInput class="big-text" formControlName="PropuestaEspecialista"></textarea>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="container-fluid p-0">
        <div class="row">
          <div class="col">
            <mat-form-field class="mr-5 big-text">
              <mat-label>¿Qué resultado se obtendría de aplicar la mejora propuesta?</mat-label>
              <textarea matInput class="big-text" formControlName="ResultadoPropuestaEspecialista"></textarea>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field class="mr-5 big-text">
              <mat-label>Mejora propuesta por el administrador</mat-label>
              <textarea matInput class="big-text" formControlName="PropuestaAdministrador"></textarea>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="container-fluid p-0">
        <div class="row">
          <div class="col">
            <mat-form-field class="mr-5 big-text">
              <mat-label>¿Qué resultado se obtendría de aplicar la mejora propuesta?</mat-label>
              <textarea matInput class="big-text" formControlName="ResultadoPropuestaAdministrador"></textarea>
            </mat-form-field>
          </div>
          <div class="col">

          </div>
        </div>
      </div>
      <div class="mt-3">
        <button mat-button type="button" matStepperPrevious>Back</button>
        <button mat-button type="submit" disabled (click)="registrar()">Registrar</button>
        <button mat-button type="button" (click)="stepper.reset()">Reset</button>
      </div>
  </mat-step>
</mat-horizontal-stepper>
</form>